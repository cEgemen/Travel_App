const {
    GoogleGenerativeAI,
    HarmCategory,
    HarmBlockThreshold,
  } = require("@google/generative-ai");
  
  const apiKey = process.env.GEMINI_API_KEY;
  const genAI = new GoogleGenerativeAI(apiKey);
  
  const model = genAI.getGenerativeModel({
    model: "gemini-2.0-flash-exp",
  });
  
  const generationConfig = {
    temperature: 1,
    topP: 0.95,
    topK: 40,
    maxOutputTokens: 8192,
    responseMimeType: "application/json",
  };
  
  export  const chatSession = model.startChat({
      generationConfig,
      history: [
        {
          role: "user",
          parts: [
            {text: "Generate a detailed travel itinerary in JSON format for the location: Istanbul,Turkey, covering 3 days and 2 nights. Include:\nHotels: Provide details such as hotelName, hotelAddress, price in units or local currency (e.g., 20 TRY, $15, or €10), rating, geoCoordinates, description.\nDaily Travel Plan: For each day, provide a detailed schedule with multiple activities, including:\nactivityName: Name of the activity or place.\nactivityDetails: A brief description of the activity.\nrating: A user review score for the activity or place.\nprice: The cost of visiting the activity or location expressed in units or local currency (e.g., 20 TRY, $15, or €10).\nstartTime and endTime: Estimated start and end times for the activity.\ntimeToTravelFromPrevious: Time needed to travel from the previous activity or hotel.\ngeoCoordinates: Latitude and longitude of the activity location.\nEnsure all plans consider logical travel routes, realistic time allocations, and adapt based on the number of days and nights provided.\n"},
          ],
        },
        {
          role: "model",
          parts: [
            {text: "```json\n{\n  \"location\": \"Istanbul, Turkey\",\n  \"duration\": {\n    \"days\": 3,\n    \"nights\": 2\n  },\n    \"hotels\": [\n    {\n      \"hotelName\": \"The Ritz-Carlton, Istanbul\",\n      \"hotelAddress\": \"Asker Ocağı Caddesi No:6, Şişli, 34367 Istanbul, Turkey\",\n      \"price\": \"€350\",\n      \"rating\": 4.8,\n      \"geoCoordinates\": {\n        \"latitude\": 41.049915,\n        \"longitude\": 28.995789\n      },\n      \"description\": \"Luxury hotel offering stunning views of the Bosphorus, fine dining, and a spa.\"\n     },\n      {\n      \"hotelName\": \"Sultanhan Hotel - Special Category\",\n      \"hotelAddress\": \"Alemdar Mahallesi, Ticarethane Sk. No:16, 34110 Fatih/İstanbul, Türkiye\",\n      \"price\": \"2000 TRY\",\n      \"rating\": 4.6,\n      \"geoCoordinates\": {\n        \"latitude\": 41.008498,\n         \"longitude\": 28.976465\n         },\n      \"description\": \"Charming hotel in the heart of Sultanahmet with traditional Turkish design and a rooftop terrace.\"\n    }\n  ],\n  \"dailyPlan\": [\n    {\n      \"day\": 1,\n      \"activities\": [\n        {\n          \"activityName\": \"Hagia Sophia\",\n          \"activityDetails\": \"Visit the iconic Hagia Sophia, a former Greek Orthodox patriarchal basilica, later an imperial mosque, and now a museum.\",\n          \"rating\": 4.9,\n          \"price\": \"180 TRY\",\n          \"startTime\": \"09:00\",\n          \"endTime\": \"11:00\",\n          \"timeToTravelFromPrevious\": \"0 min (Starting point)\",\n            \"geoCoordinates\": {\n              \"latitude\": 41.008624,\n              \"longitude\": 28.980156\n           }\n        },\n        {\n          \"activityName\": \"Blue Mosque (Sultan Ahmed Mosque)\",\n          \"activityDetails\": \"Explore the Blue Mosque, famous for its stunning blue tiles and six minarets.\",\n          \"rating\": 4.7,\n          \"price\": \"Free\",\n          \"startTime\": \"11:30\",\n          \"endTime\": \"13:00\",\n          \"timeToTravelFromPrevious\": \"10 min\",\n           \"geoCoordinates\": {\n              \"latitude\": 41.005780,\n              \"longitude\": 28.977423\n            }\n        },\n          {\n          \"activityName\": \"Lunch at a Traditional Turkish Restaurant\",\n          \"activityDetails\": \"Enjoy authentic Turkish cuisine at a local restaurant in the Sultanahmet area.\",\n          \"rating\": 4.5,\n          \"price\": \"300 TRY\",\n          \"startTime\": \"13:00\",\n          \"endTime\": \"14:30\",\n          \"timeToTravelFromPrevious\":\"5 min\",\n            \"geoCoordinates\": {\n              \"latitude\": 41.008016,\n              \"longitude\": 28.977858\n            }\n        },\n        {\n          \"activityName\": \"Topkapi Palace\",\n           \"activityDetails\": \"Discover the opulence of the Topkapi Palace, the former residence of Ottoman Sultans.\",\n           \"rating\": 4.6,\n           \"price\": \"320 TRY\",\n           \"startTime\": \"15:00\",\n           \"endTime\": \"17:30\",\n           \"timeToTravelFromPrevious\": \"15 min\",\n             \"geoCoordinates\": {\n              \"latitude\": 41.011588,\n              \"longitude\": 28.983302\n             }\n        },\n        {\n          \"activityName\": \"Dinner in Karakoy\",\n          \"activityDetails\": \"Enjoy a delicious dinner at one of the trendy restaurants in Karakoy.\",\n          \"rating\": 4.4,\n          \"price\": \"400 TRY\",\n           \"startTime\":\"19:00\",\n           \"endTime\": \"21:00\",\n            \"timeToTravelFromPrevious\":\"20 min\",\n           \"geoCoordinates\":{\n            \"latitude\":41.023547,\n            \"longitude\":28.977171\n           }\n        }\n      ]\n    },\n    {\n      \"day\": 2,\n       \"activities\": [\n       {\n          \"activityName\": \"Bosphorus Cruise\",\n          \"activityDetails\": \"Take a scenic cruise along the Bosphorus Strait, enjoying views of the city from the water.\",\n          \"rating\": 4.7,\n          \"price\": \"500 TRY\",\n          \"startTime\": \"09:30\",\n           \"endTime\": \"12:00\",\n           \"timeToTravelFromPrevious\":\"40 min\",\n              \"geoCoordinates\": {\n              \"latitude\": 41.019612,\n              \"longitude\": 28.980304\n            }\n        },\n          {\n          \"activityName\": \"Spice Market (Egyptian Bazaar)\",\n          \"activityDetails\": \"Explore the vibrant Spice Market, filled with a variety of spices, sweets, and Turkish delights.\",\n          \"rating\": 4.6,\n          \"price\": \"Free (cost of goods is variable)\",\n           \"startTime\": \"12:30\",\n           \"endTime\": \"14:00\",\n           \"timeToTravelFromPrevious\": \"10 min\",\n            \"geoCoordinates\": {\n              \"latitude\": 41.015775,\n              \"longitude\": 28.970757\n            }\n        },\n           {\n          \"activityName\": \"Lunch near Spice Market\",\n          \"activityDetails\": \"Have a casual lunch at a restaurant near the Spice Market.\",\n          \"rating\": 4.3,\n          \"price\": \"250 TRY\",\n           \"startTime\":\"14:00\",\n           \"endTime\":\"15:00\",\n            \"timeToTravelFromPrevious\": \"5 min\",\n            \"geoCoordinates\": {\n              \"latitude\": 41.015595,\n              \"longitude\": 28.970214\n            }\n\n        },\n           {\n            \"activityName\": \"Galata Tower\",\n            \"activityDetails\": \"Climb the Galata Tower for panoramic views of Istanbul.\",\n            \"rating\": 4.5,\n            \"price\": \"350 TRY\",\n            \"startTime\": \"15:30\",\n            \"endTime\": \"17:00\",\n             \"timeToTravelFromPrevious\":\"15 min\",\n             \"geoCoordinates\":{\n                \"latitude\":41.023319,\n                \"longitude\":28.974087\n               }\n        },\n         {\n           \"activityName\":\"Dinner in Beyoglu\",\n            \"activityDetails\": \"Enjoy dinner in the lively neighborhood of Beyoglu.\",\n            \"rating\":4.4,\n            \"price\":\"450 TRY\",\n            \"startTime\":\"19:30\",\n            \"endTime\":\"21:30\",\n            \"timeToTravelFromPrevious\":\"15 min\",\n             \"geoCoordinates\": {\n              \"latitude\": 41.031021,\n              \"longitude\": 28.978015\n            }\n          }\n      ]\n    },\n    {\n      \"day\": 3,\n      \"activities\": [\n        {\n          \"activityName\": \"Grand Bazaar\",\n          \"activityDetails\": \"Wander through the maze-like alleys of the Grand Bazaar, one of the world's largest covered markets.\",\n          \"rating\": 4.5,\n          \"price\": \"Free (cost of goods is variable)\",\n          \"startTime\": \"09:00\",\n          \"endTime\": \"11:30\",\n           \"timeToTravelFromPrevious\": \"25 min\",\n            \"geoCoordinates\": {\n              \"latitude\": 41.010098,\n              \"longitude\": 28.968232\n            }\n        },\n         {\n           \"activityName\": \"Suleymaniye Mosque\",\n            \"activityDetails\":\"Visit the impressive Suleymaniye Mosque, known for its grand architecture and tranquil setting.\",\n             \"rating\":4.6,\n              \"price\":\"Free\",\n             \"startTime\":\"12:00\",\n            \"endTime\":\"13:30\",\n             \"timeToTravelFromPrevious\":\"10 min\",\n            \"geoCoordinates\":{\n                \"latitude\":41.014996,\n                \"longitude\":28.964483\n               }\n         },\n           {\n             \"activityName\":\"Lunch in Balat\",\n             \"activityDetails\":\"Have a relaxed lunch in the colorful Balat neighborhood.\",\n             \"rating\": 4.3,\n             \"price\":\"300 TRY\",\n             \"startTime\":\"13:30\",\n              \"endTime\":\"15:00\",\n            \"timeToTravelFromPrevious\":\"15 min\",\n             \"geoCoordinates\":{\n                \"latitude\":41.026739,\n                \"longitude\":28.950268\n               }\n          },\n        {\n            \"activityName\":\"Chora Church (Kariye Museum)\",\n            \"activityDetails\":\"Admire the stunning Byzantine mosaics and frescoes in the Chora Church.\",\n             \"rating\": 4.7,\n             \"price\": \"150 TRY\",\n              \"startTime\": \"15:30\",\n             \"endTime\":\"17:30\",\n             \"timeToTravelFromPrevious\":\"20 min\",\n              \"geoCoordinates\":{\n                \"latitude\":41.030868,\n                \"longitude\":28.940468\n              }\n          },\n        {\n          \"activityName\":\"Departure from Istanbul\",\n           \"activityDetails\":\"Travel to the airport for your onward journey.\",\n            \"rating\": \"N/A\",\n            \"price\":\"Variable\",\n           \"startTime\":\"18:30\",\n           \"endTime\":\"N/A\",\n            \"timeToTravelFromPrevious\": \"30 min\",\n             \"geoCoordinates\":{\n              \"latitude\":41.275374,\n              \"longitude\":28.763212\n             }\n        }\n      ]\n    }\n  ]\n}\n```"},
          ],
        },
      ],
    });
  
   